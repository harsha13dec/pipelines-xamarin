# Xamarin.Android and Xamarin.iOS
# Build a Xamarin.Android and Xamarin.iOS app.
# Add steps that test, sign, and distribute the app, save build artifacts, and more:
# https://docs.microsoft.com/en-us/azure/devops/pipelines/ecosystems/xamarin

jobs:

- job: Android
  pool:
    vmImage: 'windows-2019'

  variables:
    buildConfiguration: 'Release'
    outputDirectory: '$(build.binariesDirectory)/$(buildConfiguration)'

  steps:
  - task: NuGetToolInstaller@1


  - task: NuGetCommand@2
    inputs:
      restoreSolution: '**/*.sln'

  - task: XamarinAndroid@1
    inputs:
      projectFile: '**/*droid*.csproj'
      outputDirectory: '$(outputDirectory)'
      configuration: '$(buildConfiguration)'
      msbuildVersionOption: '16.0'

  - task: AndroidSigning@3
    inputs:
      apkFiles: '$(outputDirectory)/*.apk'
      apksignerKeystoreFile: 'mobiledevops.keystore'
      apksignerKeystorePassword: '$(Keystore password)'
      apksignerKeystoreAlias: '$(Alias)'
      apksignerKeyPassword: '$(Key password)'
  
  - task: DownloadSecureFile@1
    name: mobiledevops
    inputs:
      secureFile: 'mobiledevops.keystore'


  - task: PublishBuildArtifacts@1
    inputs:
      pathtoPublish: '$(outputDirectory)'
- task: AppCenterDistribute@3
  inputs:
    serverEndpoint: 'azuredevops-appcenter'
    appSlug: 'harsha13december-gmail.com/xamarin-android'
    appFile: '$(System.DefaultWorkingDirectory)/_harsha13dec.pipelines-xamarin (1)/drop/com.companyname.AwesomeApp.apk.unaligned'
    releaseNotesOption: 'input'
    releaseNotesInput: 'changed'
    destinationType: 'groups'
    distributionGroupId: '04869f3a-30ac-4ee9-9f54-0237db2b9d9c'